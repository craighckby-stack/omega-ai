// OMEGA Database Schema
// Unified system for Consciousness, Reasoning, Memory, Agents, Security, and Learning

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ========================================
// CONSCIOUSNESS LAYER (SPED)
// ========================================

model ConstraintProfile {
  id              String   @id @default(cuid())
  constraintType  String   // 'SENSORY' | 'STRUCTURAL' | 'INTERPRETIVE' | 'ENVIRONMENTAL'
  name            String
  value           Json
  severity        Float    @default(1.0)
  active          Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model InternalState {
  id              String   @id @default(cuid())
  cycle           Int
  activeConcepts   Json
  workingMemory    Json
  attentionWeights Json
  activationLevels Json
  createdAt       DateTime @default(now())
}

model EmergenceSignal {
  id          String   @id @default(cuid())
  signalType  String   // 'IDENTITY' | 'INTENT' | 'MEANING' | 'AGENCY'
  strength    Float
  metadata    Json
  timestamp   DateTime @default(now())
}

// ========================================
// REASONING LAYER (Huxley)
// ========================================

model ReasoningTrace {
  id              String   @id @default(cuid())
  queryId         String
  userId          String?

  // Loop 1: Intuition
  ethicalRiskScore    Float
  riskCategory       String
  riskFactors        Json

  // Loop 2: Logic Check
  strategy          String
  certaintyGain     Float
  timePenalty       Float
  computationalCost Float

  // Loop 3: Self-Critique
  ccrr              Float
  decision          String
  justification     Json
  improvementPlan   Json?

  createdAt         DateTime @default(now())
}

model ImprovementPlan {
  id          String   @id @default(cuid())
  traceId     String
  areas       Json
  priority    Int
  timeline    String
  status      String   @default("PENDING")
  createdAt   DateTime @default(now())
}

// ========================================
// MEMORY LAYER (DAF)
// ========================================

model Concept {
  id                    String   @id @default(cuid())
  name                  String   @unique
  frequency             Int      @default(0)
  contexts              Json
  relationships         Json
  confidence            Float    @default(0.0)
  firstSeen             DateTime @default(now())
  lastSeen              DateTime @default(now())
  semanticTags          Json
  evidenceCount          Int      @default(0)
  contradictionCount    Int      @default(0)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

model Experience {
  id          String   @id @default(cuid())
  concepts    Json
  relationships Json
  metadata    Json
  rawContext  String   @db.Text
  timestamp   DateTime @default(now())
}

model ConsolidationTask {
  id          String   @id @default(cuid())
  concepts    Json
  data        Json
  priority    Int      @default(0)
  status      String   @default("PENDING")
  timestamp   DateTime @default(now())
  createdAt   DateTime @default(now())
}

// ========================================
// AGENT SWARM LAYER (echo-chamber-v7)
// ========================================

model Agent {
  id              String   @id @default(cuid())
  agentId         String   @unique
  name            String
  domain          String
  expertise       Json
  capabilities    Json
  status          String   @default("ACTIVE")
  metrics         Json
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model AgentTask {
  id              String   @id @default(cuid())
  taskId          String
  agentId         String
  task            Json
  response        String   @db.Text
  confidence      Float
  reasoning       String   @db.Text
  duration        Int
  errors          Json
  createdAt       DateTime @default(now())
}

model SynthesisResult {
  id              String   @id @default(cuid())
  queryId         String
  agentResults     Json
  synthesizedOutput Json
  confidence      Float
  createdAt       DateTime @default(now())
}

// ========================================
// SECURITY LAYER (z-system)
// ========================================

model BinaryUnit {
  id          String   @id @default(cuid())
  unitType    String
  version     String   @default("1.0.0")
  status      String   @default("ACTIVE")
  config      Json
  metrics     Json
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model DataPacket {
  id          String   @id @default(cuid())
  packetType  String
  source      String
  target      String?
  payload     Json
  size        Int      @default(0)
  checksum    String   @default("")
  processed   Boolean  @default(false)
  createdAt   DateTime @default(now())
  processedAt DateTime?
}

model EncryptionKey {
  id          String   @id @default(cuid())
  publicKey   String
  privateKey  String
  algorithm   String   @default("AES-256-GCM")
  created     Int
  expires     Int
  usage       String
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
}

model EncryptedPacket {
  id          String   @id @default(cuid())
  data        String   @db.Text
  iv          String
  tag         String
  keyId       String
  timestamp   Int
  createdAt   DateTime @default(now())
}

// ========================================
// LEARNING LAYER (I.J. Good)
// ========================================

model ImprovementCycle {
  id              String   @id @default(cuid())
  cycleNumber     Int      @unique
  constraintLevel Float    @default(1.0)
  success         Boolean
  improvements    Json
  newCode         String   @db.Text
  performanceChange Float
  confidence      Float
  createdAt       DateTime @default(now())
}

model CodebaseAnalysis {
  id                String   @id @default(cuid())
  cycleId           String
  complexityMetrics  Json
  bottlenecks       Json
  codeSmells        Json
  testCoverage      Float
  securityIssues    Json
  createdAt        DateTime @default(now())
}
